name: Travel Request
states:  # The first state is always the initial state.
  - name: Not started
    actions:
      - name: Initiate
        template:
          fields:
            - name: Name
              field_type: text
              required: true
            - name: Destination
              field_type: text
              required: true
              description: Where are you going?
            - name: Cost
              field_type: number
              required: true
            - name: Supervisor Email
              field_type: email
              required: true
        handler: |
            change_state('Awaiting Supervisor Approval')
            assign(data.supervisor_email, send_email=True)

  - name: Awaiting Supervisor Approval
    actions:
      - name: Approve
        handler: |
            if data.cost >= 500:
                change_state('Awaiting CFO Approval')
                assign(data.dept_head_email, send_email=True)
            else:
                change_state('Approved')
      - name: Reject
        template:
          fields:
            - name: Reason
              field_type: paragraph
        handler: |
            change_state('Rejected')
            assign(data.initiator_email, send_email=True)

  - name: Awaiting CFO Approval
    actions:
      - name: Approve
        handler: |
            change_state('Approved')
            assign(data.initiator_email, send_email=True)
      - name: Reject
        template: # rejection reason
        handler: |
            change_state('Rejected')
            assign(data.initiator_email, send_email=True)

  - name: Approved

  - name: Rejected